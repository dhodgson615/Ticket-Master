{% extends "base.html" %}

{% block title %}Home - Ticket-Master{% endblock %}

{% block content %}
<div class="welcome-section">
    <div class="welcome-content">
        <h2>Generate GitHub Issues with AI</h2>
        <p>Analyze your Git repository and automatically generate relevant GitHub issues based on code changes, patterns, and best practices.</p>
    </div>
</div>

<div class="form-section">
    <div class="form-container">
        <h3>Repository Configuration</h3>
        <form method="POST" action="{{ url_for('generate_issues') }}" class="issue-form">
            <div class="form-group">
                <label for="github_repo">
                    <span class="label-text">GitHub Repository</span>
                    <span class="label-required">*</span>
                </label>
                <input
                    type="text"
                    id="github_repo"
                    name="github_repo"
                    required
                    placeholder="owner/repository-name or https://github.com/owner/repo"
                    class="form-input"
                >
                <small class="help-text">GitHub repository in format "owner/repo" or full GitHub URL (e.g., "microsoft/vscode")</small>
            </div>

            <div class="form-group">
                <label for="repository_path">
                    <span class="label-text">Local Repository Path</span>
                    <span class="label-optional">(optional)</span>
                </label>
                <input
                    type="text"
                    id="repository_path"
                    name="repository_path"
                    placeholder="/path/to/your/git/repository (leave empty to clone automatically)"
                    class="form-input"
                >
                <small class="help-text">Optional: Path to local Git repository. If not provided, the repository will be cloned automatically</small>
            </div>

            <div class="form-group">
                <label for="max_issues">
                    <span class="label-text">Maximum Issues</span>
                </label>
                <input
                    type="number"
                    id="max_issues"
                    name="max_issues"
                    min="1"
                    max="20"
                    value="5"
                    class="form-input"
                >
                <small class="help-text">Maximum number of issues to generate (1-20)</small>
            </div>

            <div class="form-group">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="dry_run" name="dry_run" class="form-checkbox">
                    <label for="dry_run" class="checkbox-label">
                        <span class="checkbox-text">Dry Run</span>
                        <small class="checkbox-help">Preview issues without creating them on GitHub</small>
                    </label>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <span class="btn-icon">üöÄ</span>
                    Generate Issues
                </button>
            </div>
        </form>
    </div>
</div>

<div class="info-section">
    <div class="info-grid">
        <div class="info-card">
            <div class="info-icon">üîç</div>
            <h4>Repository Analysis</h4>
            <p>Analyzes Git history, file changes, and code patterns to understand your project structure and identify improvement opportunities.</p>
        </div>

        <div class="info-card">
            <div class="info-icon">ü§ñ</div>
            <h4>AI-Powered Generation</h4>
            <p>Uses intelligent heuristics to generate relevant issues for documentation, testing, code quality, and maintenance.</p>
        </div>

        <div class="info-card">
            <div class="info-icon">‚ö°</div>
            <h4>GitHub Integration</h4>
            <p>Seamlessly creates issues directly in your GitHub repository with proper labels and formatting.</p>
        </div>
    </div>
</div>

<div class="requirements-section">
    <div class="requirements-content">
        <h3>Prerequisites</h3>
        <ul class="requirements-list">
            <li>
                <span class="req-icon">üåê</span>
                <strong>GitHub Repository:</strong> Provide a GitHub repository URL or name in "owner/repo" format
            </li>
            <li>
                <span class="req-icon">üîë</span>
                <strong>GitHub Token (for private repos):</strong> Set <code>GITHUB_TOKEN</code> environment variable for private repositories or to create issues
            </li>
            <li>
                <span class="req-icon">üìÅ</span>
                <strong>Local Repository (optional):</strong> Optionally provide a local path - otherwise the repository will be cloned automatically
            </li>
        </ul>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Simple form validation and UX improvements
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('.issue-form');
        const submitBtn = form.querySelector('.btn-primary');

        form.addEventListener('submit', function(e) {
            // Show loading state
            submitBtn.innerHTML = '<span class="btn-icon">‚è≥</span> Generating Issues...';
            submitBtn.disabled = true;

            // Basic client-side validation
            const repoPath = document.getElementById('repository_path').value.trim();
            const githubRepo = document.getElementById('github_repo').value.trim();

            // Only GitHub repo is required now
            if (!githubRepo) {
                e.preventDefault();
                submitBtn.innerHTML = '<span class="btn-icon">üöÄ</span> Generate Issues';
                submitBtn.disabled = false;
                alert('Please provide a GitHub repository.');
                return;
            }

            // Validate GitHub repo format - accept URLs or owner/repo format
            const isUrl = githubRepo.startsWith('http://') || githubRepo.startsWith('https://');
            const isOwnerRepo = githubRepo.includes('/') && !isUrl && githubRepo.split('/').length === 2;

            if (!isUrl && !isOwnerRepo) {
                e.preventDefault();
                submitBtn.innerHTML = '<span class="btn-icon">üöÄ</span> Generate Issues';
                submitBtn.disabled = false;
                alert('GitHub repository must be in format "owner/repo" or a valid GitHub URL');
                return;
            }
        });
    });
</script>
{% endblock %}